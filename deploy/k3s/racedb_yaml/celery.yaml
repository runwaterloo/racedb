kind: Deployment
apiVersion: apps/v1
metadata:
  name: racedb-celery
spec:
  replicas: 1
  selector:
    matchLabels:
      app: racedb-celery
  template:
    metadata:
      labels:
        app: racedb-celery
    spec:
      containers:
        - name: racedb-celery
          command: [
            "/bin/sh",
            "-c",
            "DJANGO_SETTINGS_MODULE=racedb.settings.prod celery -A racedb worker -l info --pidfile=/tmp/celery.pid",
            ]
          image: registry.gitlab.com/sl70176/racedb:0b4a4e9d
          volumeMounts:
            - mountPath: /srv/racedb/racedb/secrets.py
              name: racedb-secrets
            - mountPath: /root/.flickr/oauth-tokens.sqlite
              name: racedb-flickr-oauth
      volumes:
        - name: racedb-secrets
          hostPath:
            path: /srv/racedb_secrets/secrets.py
        - name: racedb-flickr-oauth
          hostPath:
            path: /srv/racedb_secrets/flickr_oauth-tokens.sqlite
